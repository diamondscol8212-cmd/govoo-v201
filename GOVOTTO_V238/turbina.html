<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vórtice de Datos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;900&family=JetBrains+Mono:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --primary: #00ffcc;
            --accent: #a200ff;
            --risk: #FF0044;
            --bg: #030303;
        }
        
        body {
            margin: 0; background: var(--bg); color: white;
            font-family: 'Outfit', sans-serif; overflow: hidden;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh;
            background-image: 
                radial-gradient(circle at center, rgba(162, 0, 255, 0.05) 0%, transparent 70%),
                linear-gradient(0deg, rgba(0,0,0,0.8) 0%, transparent 100%);
        }

        /* --- 1. ESTACIÓN DE PREGUNTAS (El Peaje) --- */
        #question-station {
            position: absolute; inset: 0; z-index: 50;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(5,5,5,0.95); backdrop-filter: blur(10px);
            transition: opacity 0.5s ease;
        }
        
        .q-card {
            width: 90%; max-width: 340px; text-align: center;
            padding: 30px 20px; border: 1px solid rgba(162,0,255,0.3);
            border-radius: 20px; background: rgba(10,10,10,0.8);
            box-shadow: 0 0 30px rgba(162,0,255,0.1), inset 0 0 20px rgba(0,0,0,1);
            animation: float 4s ease-in-out infinite;
        }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        .btn-answer {
            width: 100%; padding: 15px; margin-top: 15px;
            background: transparent; border: 2px solid #333; color: #fff;
            border-radius: 12px; font-weight: 900; font-size: 1.1rem;
            text-transform: uppercase; cursor: pointer; transition: 0.2s;
        }
        .btn-answer:active { transform: scale(0.95); }
        .btn-a { border-color: var(--primary); color: var(--primary); }
        .btn-b { border-color: var(--accent); color: var(--accent); }

        /* --- 2. EL VÓRTICE (El Motor Físico) --- */
        #vortex-station {
            display: none; flex-direction: column; align-items: center; justify-content: center;
            width: 100%; height: 100%; position: relative; z-index: 10;
            opacity: 0; transition: opacity 1s ease;
        }

        .vortex-container {
            position: relative; width: 260px; height: 260px;
            display: flex; align-items: center; justify-content: center;
            perspective: 800px; /* Profundidad para el 3D */
        }

        .ring {
            position: absolute; border-radius: 50%;
            border: 2px dashed transparent;
            transform-style: preserve-3d;
            transition: all 0.3s ease;
        }

        /* Anillos Cuánticos */
        .ring-outer {
            width: 100%; height: 100%; border-color: rgba(0,255,204,0.3);
            border-left: 2px solid var(--primary);
            animation: spin 10s linear infinite;
            box-shadow: 0 0 20px rgba(0,255,204,0.1);
        }
        .ring-middle {
            width: 75%; height: 75%; border-color: rgba(162,0,255,0.4);
            border-right: 2px solid var(--accent);
            animation: spin 7s linear infinite reverse;
            box-shadow: inset 0 0 20px rgba(162,0,255,0.2);
        }
        .ring-inner {
            width: 50%; height: 50%; border: 2px dotted #fff;
            animation: spin 3s linear infinite;
        }

        /* El Núcleo de Extracción */
        .vortex-core {
            width: 80px; height: 80px; border-radius: 50%;
            background: #000; border: 3px solid var(--primary);
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 40px var(--primary), inset 0 0 20px var(--primary);
            z-index: 20; transition: all 0.1s;
        }

        .multiplier-text {
            font-family: 'JetBrains Mono', monospace; font-size: 1.5rem;
            font-weight: 900; color: #fff; text-shadow: 0 0 10px var(--primary);
        }

        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* --- 3. CONTROLES DE TENSIÓN --- */
        .control-pad {
            position: absolute; 
            bottom: 140px; /* <--- AQUÍ ESTÁ LA MAGIA: Lo subimos 100px para no chocar con Cerrar Brecha */
            width: 90%; 
            max-width: 300px;
            text-align: center;
        }

        .btn-extract {
            width: 100%; padding: 20px; border-radius: 50px;
            background: rgba(10,10,10,0.8); border: 2px solid var(--primary);
            color: var(--primary); font-weight: 900; font-size: 1.2rem;
            letter-spacing: 2px; text-transform: uppercase;
            box-shadow: 0 0 20px rgba(0,255,204,0.2);
            user-select: none; -webkit-user-select: none; cursor: pointer;
            transition: all 0.2s;
        }

        .btn-extract:active { background: var(--primary); color: #000; transform: scale(0.95); }

        /* ESTADOS DE SOBRECARGA (Cuando mantiene presionado) */
        .charging .ring-outer { animation-duration: 2s; border-color: var(--risk); box-shadow: 0 0 40px var(--risk); }
        .charging .ring-middle { animation-duration: 1.5s; border-color: #ffaa00; }
        .charging .ring-inner { animation-duration: 0.5s; border-color: #fff; }
        .charging .vortex-core { border-color: var(--risk); box-shadow: 0 0 60px var(--risk), inset 0 0 30px var(--risk); transform: scale(1.1); }
        .charging .multiplier-text { color: var(--risk); text-shadow: 0 0 20px var(--risk); }

        .crashed .vortex-core { background: #333; border-color: #111; box-shadow: none; transform: scale(0.8); }
        .crashed .multiplier-text { color: #555; text-shadow: none; }
        .crashed .ring { animation-play-state: paused; opacity: 0.2; }
    </style>
</head>
<body>

    <div id="question-station">
        <div class="q-card">
            <i class="fas fa-database text-3xl text-[#a200ff] mb-4"></i>
            <h2 class="text-[10px] text-zinc-500 tracking-[0.4em] uppercase mb-4">Extracción de Perfil</h2>
            <p id="q-text" class="text-xl font-black italic text-white mb-6 uppercase leading-tight"></p>
            
            <button class="btn-answer btn-a" onclick="activateVortex()">SÍ, TOTALMENTE</button>
            <button class="btn-answer btn-b" onclick="activateVortex()">NO, JAMÁS</button>
        </div>
    </div>

    <div id="vortex-station">
        <div class="text-[10px] text-zinc-500 tracking-[0.4em] uppercase mb-10 absolute top-10">
            Costo de Enlace: <span class="text-[#00ffcc] font-black">-$100 COP</span>
        </div>

        <div class="vortex-container" id="v-container">
            <div class="ring ring-outer"></div>
            <div class="ring ring-middle"></div>
            <div class="ring ring-inner"></div>
            <div class="vortex-core">
                <span class="multiplier-text" id="multi-display">1.00x</span>
            </div>
        </div>

        <div class="control-pad">
            <p id="status-text" class="text-xs text-zinc-400 mb-4 font-mono">MANTÉN PRESIONADO PARA EXTRAER</p>
            <button class="btn-extract" id="btn-extract">EXTRAER</button>
        </div>
    </div>

    <script>
      // --- 1. BASE DE DATOS Y SECUENCIA ---
        const questions = [
            "¿Venderías tu historial de navegación completo por $10,000 dólares?",
            "¿Consideras que la empatía humana es un defecto en los negocios?",
            "¿Mentirías sobre tus ingresos para entrar a un círculo social de élite?",
            "¿Sientes que el dinero virtual (cripto) es más real que el papel?",
            "¿Prefieres el estrés del riesgo constante a una vida de seguridad mediocre?"
        ];

        let currentQuestionIndex = 0;
        let totalReward = 0;

      function loadNextQuestion() {
            // Si terminamos las 5 preguntas, ejecutamos la Pantalla de Cierre
            if (currentQuestionIndex >= questions.length) {
                // 1. Ocultar el Vórtice
                document.getElementById('vortex-station').style.display = 'none';
                
                // 2. Traer de vuelta la tarjeta de cristal
                const qStation = document.getElementById('question-station');
                qStation.style.display = 'flex';
                qStation.style.opacity = '1';
                
                // 3. Mensaje Épico de Cierre y ocultar botones
                document.getElementById('q-text').innerText = "SINCRO COMPLETADA.\nDATOS ENVIADOS A DANTE.";
                document.getElementById('q-text').style.color = "var(--primary)";
                document.querySelector('.btn-a').style.display = 'none';
                document.querySelector('.btn-b').style.display = 'none';
                
                // 4. Enviar la señal de cierre y el dinero al engine.js
                setTimeout(() => {
                    window.parent.postMessage({ action: 'close_casino_game', reward: totalReward }, '*');
                }, 1500); // Espera 1.5 segundos para que el usuario lea el mensaje
                
                return;
            }
            
            // --- CÓDIGO NORMAL PARA LAS PREGUNTAS 1 A 5 ---
            // Restaurar estación de preguntas
            document.getElementById('q-text').innerText = questions[currentQuestionIndex];
            document.getElementById('vortex-station').style.display = 'none';
            document.getElementById('vortex-station').style.opacity = '0';
            
            const qStation = document.getElementById('question-station');
            qStation.style.display = 'flex';
            setTimeout(() => qStation.style.opacity = '1', 50);

            // Reiniciar estado del Vórtice
            multiplier = 1.00;
            document.getElementById('multi-display').innerText = "1.00x";
            const vContainer = document.getElementById('v-container');
            vContainer.classList.remove('crashed', 'charging');
            
            const sText = document.getElementById('status-text');
            sText.innerText = "MANTÉN PRESIONADO PARA EXTRAER";
            sText.style.color = "#9ca3af"; // color original zinc-400
            
            const btnExtract = document.getElementById('btn-extract');
            btnExtract.innerText = "EXTRAER";
            btnExtract.style.borderColor = "var(--primary)";
            btnExtract.style.color = "var(--primary)";
            gameActive = true;
            isHolding = false;
        }

        // --- 2. MOTOR DE AUDIO ---
        let audioCtx;
        let chargeOsc, chargeGain;

        function initAudio() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }

        function playSynth(type) {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            if (type === 'start') {
                chargeOsc = osc; chargeGain = gain;
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(50, audioCtx.currentTime); 
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                osc.start();
            } else if (type === 'cashout') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(880, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1);
                osc.start(); osc.stop(audioCtx.currentTime + 1);
            } else if (type === 'crash') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(100, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(10, audioCtx.currentTime + 0.5);
                gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                osc.start(); osc.stop(audioCtx.currentTime + 0.5);
            }
        }

        function updateChargeSound(mult) {
            if (chargeOsc && audioCtx) {
                const newFreq = 50 + (mult * 150);
                chargeOsc.frequency.linearRampToValueAtTime(newFreq, audioCtx.currentTime + 0.1);
            }
        }

        function stopChargeSound() {
            if (chargeOsc && chargeGain) {
                chargeGain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                setTimeout(() => chargeOsc.stop(), 100);
            }
        }

        // --- 3. LÓGICA DEL VÓRTICE ---
        let isHolding = false;
        let gameActive = true;
        let multiplier = 1.00;
        let crashPoint = 0;
        let gameInterval = null;
        let hapticInterval = null;
        const COSTO_ENTRADA = 100;

        function activateVortex() {
            initAudio();
            document.getElementById('question-station').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('question-station').style.display = 'none';
                const vStation = document.getElementById('vortex-station');
                vStation.style.display = 'flex';
                setTimeout(() => vStation.style.opacity = '1', 50);
            }, 500);

            const luck = Math.random();
            if (luck < 0.5) crashPoint = 1.1 + (Math.random() * 0.4); 
            else if (luck < 0.8) crashPoint = 1.5 + (Math.random() * 1.0); 
            else crashPoint = 2.5 + (Math.random() * 2.5); 
        }

        const btnExtract = document.getElementById('btn-extract');
        const vContainer = document.getElementById('v-container');
        const mDisplay = document.getElementById('multi-display');
        const sText = document.getElementById('status-text');

        btnExtract.addEventListener('mousedown', startExtraction);
        btnExtract.addEventListener('touchstart', (e) => { e.preventDefault(); startExtraction(); });

        window.addEventListener('mouseup', stopExtraction);
        window.addEventListener('touchend', stopExtraction);

        function startExtraction() {
            if(!gameActive || isHolding) return;
            isHolding = true;
            
            initAudio();
            playSynth('start');
            vContainer.classList.add('charging');
            sText.innerText = "¡SACA ANTES DE LA SOBRECARGA!";
            sText.style.color = "var(--risk)";

            let vibRate = 400;
            hapticInterval = setInterval(() => {
                try { if(navigator.vibrate) navigator.vibrate(50); } catch(e){}
                vibRate = Math.max(50, vibRate - 20); 
            }, vibRate);

            gameInterval = setInterval(() => {
                multiplier += 0.01; 
                if(multiplier > 2.0) multiplier += 0.02; 
                if(multiplier > 4.0) multiplier += 0.05; 

                mDisplay.innerText = multiplier.toFixed(2) + "x";
                updateChargeSound(multiplier);

                if (multiplier >= crashPoint) {
                    crashVortex();
                }
            }, 50); 
        }

        function stopExtraction() {
            if(!isHolding || !gameActive) return;
            isHolding = false;
            gameActive = false;
            
            clearInterval(gameInterval);
            clearInterval(hapticInterval);
            stopChargeSound();

            vContainer.classList.remove('charging');
            
            playSynth('cashout');
            try { if(navigator.vibrate) navigator.vibrate([100, 50, 300]); } catch(e){}
            
            const gananciaBruta = COSTO_ENTRADA * multiplier;
            const gananciaNeta = Math.floor(gananciaBruta - COSTO_ENTRADA);
            
            sText.innerText = "¡DATOS EXTRAÍDOS CON ÉXITO!";
            sText.style.color = "var(--primary)";
            btnExtract.innerText = `+$${gananciaNeta} COP`;
            btnExtract.style.borderColor = "var(--primary)";

            // Acumular ganancia y pasar a la siguiente pregunta
            totalReward += gananciaNeta;
            currentQuestionIndex++;
            setTimeout(() => { loadNextQuestion(); }, 2500);
        }

        function crashVortex() {
            isHolding = false;
            gameActive = false;
            
            clearInterval(gameInterval);
            clearInterval(hapticInterval);
            stopChargeSound();

            vContainer.classList.remove('charging');
            vContainer.classList.add('crashed');
            
            playSynth('crash');
            try { if(navigator.vibrate) navigator.vibrate([300, 100, 400]); } catch(e){}
            
            sText.innerText = "¡SOBRECARGA DEL NÚCLEO!";
            btnExtract.innerText = "COLAPSO CRÍTICO";
            btnExtract.style.borderColor = "var(--risk)";
            btnExtract.style.color = "var(--risk)";

            // Perder costo y pasar a la siguiente pregunta
            totalReward -= COSTO_ENTRADA;
            currentQuestionIndex++;
            setTimeout(() => { loadNextQuestion(); }, 2500);
        }

        // Arrancar
        loadNextQuestion();
    </script>
</body>
</html>