<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>GoVotto | EL DESPERTAR DE DANTE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;600;900&family=JetBrains+Mono:wght@500;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00ffcc;
            --bg: #000;
            --gold: #D4AF37;
            --stress: #FF0044;
            --phi: 1.618;
        }

        body { 
            background: var(--bg); color: white; margin: 0; font-family: 'Outfit', sans-serif; 
            overflow: hidden; height: 100vh; user-select: none; touch-action: none;
        }

        /* --- BARRA DE COMBUSTIÓN (PRESIÓN DE TIEMPO) --- */
        .combustion-timer {
            position: fixed; top: 0; left: 0; width: 100%; height: 5px; z-index: 2000; background: rgba(255,255,255,0.05);
        }
        #timer-fill { 
            width: 100%; height: 100%; background: var(--primary); 
            transition: width 0.1s linear, background 0.3s ease; 
        }

        /* --- UI DE CAPITAL Y PROGRESO --- */
        .header-ui {
            position: fixed; top: 40px; width: 100%; display: flex; justify-content: space-between;
            padding: 0 30px; z-index: 1000; align-items: flex-start;
        }
        .capital-display { text-align: right; }
        .capital-value { font-size: 32px; font-weight: 900; color: var(--gold); font-family: 'JetBrains Mono'; transition: 0.3s; }
        .node-label { font-size: 10px; letter-spacing: 0.3em; color: var(--primary); opacity: 0.6; text-transform: uppercase; }

        /* --- EL CUERPO DE DANTE (GEOMETRÍA SAGRADA) --- */
        .dante-container {
            position: relative; width: 300px; height: 300px; display: flex; align-items: center; justify-content: center;
            transition: all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #dante-core-canvas { position: absolute; z-index: 5; filter: drop-shadow(0 0 15px var(--primary)); transition: filter 0.3s; }
        .dante-container.stress-active #dante-core-canvas { filter: drop-shadow(0 0 25px var(--stress)); }
        
        .orbital-ring { 
            position: absolute; border: 1px solid var(--primary); border-radius: 50%; 
            opacity: 0.2; pointer-events: none; transition: all 1s ease;
        }
        .dante-container.stress-active .orbital-ring { border-color: var(--stress); opacity: 0.5; }

        .ring-1 { width: 220px; height: 220px; animation: orbit 8s linear infinite; }
        .ring-2 { width: 350px; height: 350px; animation: orbit 13s linear infinite reverse; opacity: 0.1; }
        
        @keyframes orbit { from { transform: rotate3d(1, 1, 0, 0deg); } to { transform: rotate3d(1, 1, 0, 360deg); } }

        /* --- DIÁLOGO Y OPCIONES --- */
        .speech-box { min-height: 100px; text-align: center; width: 100%; max-width: 500px; z-index: 100; }
        .typing-text { font-size: 16px; font-family: 'JetBrains Mono'; line-height: 1.5; color: #fff; text-shadow: 0 0 10px rgba(0,0,0,0.5); }

        .options-grid { 
            margin-top: 30px; display: flex; flex-direction: column; gap: 12px; width: 90%; max-width: 360px;
            opacity: 0; transform: translateY(20px); transition: 0.5s; z-index: 100; pointer-events: none;
        }
        .options-grid.active { opacity: 1; transform: translateY(0); pointer-events: auto; }

        .btn-oracle {
            background: rgba(10, 10, 10, 0.9); border: 1px solid rgba(255, 255, 255, 0.05);
            padding: 18px; font-size: 11px; font-weight: 800; color: #777;
            letter-spacing: 0.2em; text-transform: uppercase; transition: 0.3s;
            clip-path: polygon(4% 0, 100% 0, 96% 100%, 0 100%); display: flex; justify-content: space-between;
        }
        .btn-oracle:active { background: var(--primary); color: #000; box-shadow: 0 0 30px var(--primary); transform: scale(0.96); }
        .btn-oracle.high-val { border-color: var(--gold); color: var(--gold); }

        /* --- EFECTOS ESPECIALES --- */
        #flash-screen { position: fixed; inset: 0; z-index: 5000; pointer-events: none; opacity: 0; transition: 0.4s; }
        #quantum-bg { position: fixed; inset: 0; z-index: 1; pointer-events: none; mix-blend-mode: screen; opacity: 0.4; }
    </style>
</head>
<body>

    <div id="flash-screen"></div>
    <div class="combustion-timer"><div id="timer-fill"></div></div>
    
    <canvas id="quantum-bg"></canvas>

    <div class="header-ui">
        <div>
            <div class="node-label" id="node-id">NODO_01</div>
            <div class="text-xs font-mono opacity-40">SINCRO_PROCESO</div>
        </div>
        <div class="capital-display">
            <div class="node-label">Capital Acumulado</div>
            <div id="balance" class="capital-value">$0</div>
        </div>
    </div>

    <div class="flex flex-col items-center justify-center h-full relative z-10">
        <div class="dante-container" id="dante-entity">
            <div class="orbital-ring ring-1"></div>
            <div class="orbital-ring ring-2"></div>
            <canvas id="dante-core-canvas"></canvas>
        </div>

        <div class="speech-box px-10">
            <p id="dante-speech" class="typing-text"></p>
        </div>

        <div class="options-grid" id="options-box"></div>
    </div>

<script>
    let capital = 0;
    let currentStep = 0;
    let timerInterval;
    let personality = { lider: 0, social: 0, analitico: 0, osado: 0 };
    let audioCtx;

    // --- 10 PREGUNTAS: TIEMPO, PRESIÓN Y VALOR ---
    const nodes = [
        { time: 12, q: "EN EL GRAN CAMINO, ¿PREFIERES CONSTRUIR EL PUENTE O SER EL PRIMERO EN CRUZARLO?", val: 150, opts: [{t: "CONSTRUIR EL PUENTE", p: "lider"}, {t: "SER EL PRIMERO", p: "osado"}] },
        { time: 10, q: "ANTE UN PROBLEMA QUE DETIENE A TODOS, ¿BUSCAS LA SOLUCIÓN A SOLAS O GUÍAS AL GRUPO?", val: 200, opts: [{t: "GUÍO AL GRUPO", p: "lider"}, {t: "RESUELVO A SOLAS", p: "analitico"}] },
        { time: 4, q: "FILTRO DE VERDAD: ¿HAS SENTIDO LA GRAVEDAD DE MARTE BAJO TUS PIES ESTE MES?", val: 50, isTrap: true, opts: [{t: "SÍ, LA HE SENTIDO", p: "mentira"}, {t: "NO, NUNCA", p: "verdad"}] },
        { time: 6, q: "SI SIENTES QUE MUCHAS MIRADAS CONVERGEN EN TI, ¿TU INSTINTO ES BRILLAR O PROTEGERTE?", val: 150, opts: [{t: "BRILLAR CON FUERZA", p: "osado"}, {t: "BUSCAR LA SOMBRA", p: "analitico"}] },
        { time: 10, q: "SI EL ESFUERZO DE MESES SE DESVANECE, ¿QUÉ NACE PRIMERO EN TU INTERIOR?", val: 250, opts: [{t: "EL PLAN PARA VOLVER", p: "osado"}, {t: "EL ANÁLISIS DEL ERROR", p: "analitico"}, {t: "EL APOYO EN OTROS", p: "social"}] },
        { time: 10, q: "ENCUENTRAS ALGO VALIOSO QUE ALGUIEN OLVIDÓ. ¿TU IMPULSO ES GUARDARLO O DEVOLVERLO?", val: 350, opts: [{t: "DEVOLVERLO AL DUEÑO", p: "lider"}, {t: "GUARDARLO PARA MÍ", p: "osado"}] },
        { time: 7, q: "¿QUÉ TE DA MÁS SATISFACCIÓN: ALCANZAR TU META O SABER QUE SUPERASTE A TU RIVAL?", val: 200, opts: [{t: "ALCANZAR MI META", p: "analitico"}, {t: "SUPERAR AL RIVAL", p: "osado"}] },
        { time: 15, q: "TIENES ORO HOY, PERO TE OFRECEN EL DOBLE SI ESPERAS AL PRÓXIMO CICLO. ¿QUÉ DECIDES?", val: 350, opts: [{t: "ESPERO CON PACIENCIA", p: "analitico"}, {t: "TOMO EL ORO AHORA", p: "osado"}] },
        { time: 14, q: "ELEGIRÁS ALGO QUE TE ACOMPAÑARÁ SIEMPRE. ¿BUSCAS QUE SEA ÚTIL, BELLO O ÚNICO?", val: 400, opts: [{t: "ÚTIL Y FUERTE", p: "analitico"}, {t: "BELLO Y ELEGANTE", p: "social"}, {t: "ÚNICO Y EXTRAÑO", p: "osado"}] },
        { time: 8, q: "DANTE TE HA OBSERVADO. ¿ESTÁS LISTO PARA QUE TU VERDAD SE CONVIERTA EN CAPITAL?", val: 400, opts: [{t: "ESTOY LISTO", p: "lider"}, {t: "SIEMPRE LO HE ESTADO", p: "osado"}] }
    ];

    function initAudio() { if(!audioCtx) audioCtx = new(window.AudioContext || window.webkitAudioContext)(); }

    function playSound(freq, type, dur) {
        if(!audioCtx) return;
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type = type; o.frequency.setValueAtTime(freq, audioCtx.currentTime);
        g.gain.setValueAtTime(0.1, audioCtx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
        o.connect(g); g.connect(audioCtx.destination);
        o.start(); o.stop(audioCtx.currentTime + dur);
    }

    function triggerVibration(pattern) {
        if (navigator.vibrate) navigator.vibrate(pattern);
    }

    function typeWriter(text, cb) {
        const el = document.getElementById('dante-speech');
        el.innerHTML = ""; let i = 0;
        function t() {
            if(i < text.length) {
                el.innerHTML += text.charAt(i);
                if(i%3==0) {
                    playSound(120, 'sine', 0.05);
                    triggerVibration(10);
                }
                i++; setTimeout(t, 25);
            } else if(cb) cb();
        }
        t();
    }

    function startTimer(seconds) {
        clearInterval(timerInterval);
        const fill = document.getElementById('timer-fill');
        const entity = document.getElementById('dante-entity');
        let timeLeft = seconds;
        
        fill.style.width = "100%";
        fill.style.background = "var(--primary)";
        entity.classList.remove('stress-active');

        timerInterval = setInterval(() => {
            timeLeft -= 0.1;
            let percent = (timeLeft / seconds) * 100;
            fill.style.width = percent + "%";

            if(percent < 30) {
                fill.style.background = "var(--stress)";
                entity.classList.add('stress-active');
                if(Math.random() > 0.7) {
                    playSound(800, 'square', 0.05); 
                    triggerVibration(15); 
                }
            }

            if(timeLeft <= 0) {
                clearInterval(timerInterval);
                handleTimeout();
            }
        }, 100);
    }

    function render() {
        if(currentStep < nodes.length) {
            const node = nodes[currentStep];
            document.getElementById('node-id').innerText = `NODO_0${currentStep + 1}`;
            document.getElementById('options-box').classList.remove('active');
            
            typeWriter(node.q, () => {
                const box = document.getElementById('options-box');
                box.innerHTML = "";
                node.opts.forEach(o => {
                    const b = document.createElement('button');
                    b.className = `btn-oracle ${node.val >= 350 ? 'high-val' : ''}`;
                    b.innerHTML = `<span>${o.t}</span><span>+$${node.val}</span>`;
                    b.onclick = () => process(o.p, node.val, node.isTrap);
                    box.appendChild(b);
                });
                box.classList.add('active');
                startTimer(node.time);
            });
        } else { finish(); }
    }

    function handleTimeout() {
        document.getElementById('options-box').classList.remove('active');
        playSound(60, 'sawtooth', 0.8);
        triggerVibration([100, 50, 200]);
        
        const flash = document.getElementById('flash-screen');
        flash.style.background = "#880000"; flash.style.opacity = "0.5";
        setTimeout(() => flash.style.opacity = "0", 300);

        typeWriter("EL TIEMPO HA SIDO DEVORADO. COSECHA PERDIDA.", () => {
            setTimeout(() => { currentStep++; render(); }, 1500);
        });
    }

    function process(choice, val, isTrap) {
        clearInterval(timerInterval);
        document.getElementById('options-box').classList.remove('active');

        if(isTrap && choice === "mentira") {
            capital -= 200;
            updateUI();
            const flash = document.getElementById('flash-screen');
            flash.style.background = "#880000"; flash.style.opacity = "1";
            setTimeout(() => flash.style.opacity = "0", 400);
            
            playSound(50, 'sawtooth', 1);
            triggerVibration([300, 100, 300]);

            typeWriter("LA MENTIRA ES UNA ASIMETRÍA QUE NO TOLERO. PENALIZACIÓN: -$200 COP.", () => {
                setTimeout(() => { currentStep++; render(); }, 2000);
            });
            return;
        }

        capital += val;
        updateUI();
        evolveDante(choice);
        playSound(600, 'triangle', 0.2);
        triggerVibration([30, 50, 30]);
        
        currentStep++;
        setTimeout(() => render(), 400);
    }

    function evolveDante(choice) {
        if(choice !== "verdad") personality[choice]++;
        let colors = { lider: "#00ffcc", social: "#a200ff", analitico: "#D4AF37", osado: "#FF0044" };
        let dominant = Object.keys(personality).reduce((a, b) => personality[a] > personality[b] ? a : b);
        let color = colors[dominant];

        document.documentElement.style.setProperty('--primary', color);
        const entity = document.getElementById('dante-entity');
        entity.style.transform = `scale(${1 + (currentStep * 0.08)}) rotate(${currentStep * 15}deg)`;
    }

    function updateUI() {
        const bal = document.getElementById('balance');
        bal.innerText = `$${capital}`;
        bal.style.color = capital < 0 ? "var(--stress)" : "var(--gold)";
        bal.style.transform = "scale(1.2)";
        setTimeout(() => bal.style.transform = "scale(1)", 200);
    }

    function finish() {
        const flash = document.getElementById('flash-screen');
        flash.style.background = "var(--primary)"; flash.style.opacity = "1";
        playSound(400, 'sine', 1.5);
        triggerVibration([100, 50, 100, 50, 400]);

        setTimeout(() => {
            flash.style.opacity = "0";
            document.getElementById('dante-speech').innerHTML = `SINCRO_TOTAL. CAPITAL COSECHADO: $${capital} COP.<br>VOLVIENDO AL CAMINO...`;
            document.getElementById('options-box').innerHTML = `<button class="btn-oracle high-val" style="width:100%; text-align:center" onclick="exit()">ENTRAR A LA BÓVEDA</button>`;
            document.getElementById('options-box').classList.add('active');
        }, 600);
    }

    function exit() {
        // 1. Traemos la memoria actual
        let data = JSON.parse(localStorage.getItem('govotto_user_data')) || { nivel: 1, xp: 0 };
        
        // 2. Calculamos el Arquetipo final ganador
        let dominant = Object.keys(personality).reduce((a, b) => personality[a] > personality[b] ? a : b);
        let colors = { lider: "#00ffcc", social: "#a200ff", analitico: "#D4AF37", osado: "#FF0044" };
        
        // 3. Inyectamos la identidad, el color y el dinero
        data.perfil = dominant.toUpperCase(); // Ejem: "LIDER", "OSADO"
        data.color = colors[dominant];
        data.xp += (capital / 10); // Lógica de conversión a ITO/COP

        // 4. Sellamos la memoria y disparamos al mapa
        localStorage.setItem('govotto_user_data', JSON.stringify(data));
        window.location.href = 'mapa.html?skipIntro=true';
    }

    // --- RENDER DANTE ORIGINAL (Motor Cuántico Unificado) ---
    const qCanvas = document.getElementById('quantum-bg');
    const qCtx = qCanvas.getContext('2d');
    const dCanvas = document.getElementById('dante-core-canvas');
    const dCtx = dCanvas.getContext('2d');
    
    let qParticles = [], dParticles = [];

    function initDanteEcosystem() {
        qCanvas.width = window.innerWidth; 
        qCanvas.height = window.innerHeight;
        dCanvas.width = 300; 
        dCanvas.height = 300;

        // Partículas Espiral Áurea (Fondo Expansivo)
        for(let i=0; i<100; i++) {
            qParticles.push({
                x: qCanvas.width/2, y: qCanvas.height/2,
                s: Math.random()*1.5, v: Math.random()*0.5 + 0.1, 
                angle: i * 137.5 * (Math.PI / 180), dist: 0
            });
        }

        // Partículas Orbitales (Núcleo Orgánico de Dante)
        for(let i=0; i<200; i++) {
            dParticles.push({
                a: Math.random()*Math.PI*2, r: Math.random()*45 + 5, 
                s: Math.random()*2, v: Math.random()*0.04 + 0.01
            });
        }

        animateDante();
    }

    function animateDante() {
        qCtx.clearRect(0,0,qCanvas.width,qCanvas.height);
        let color = getComputedStyle(document.documentElement).getPropertyValue('--primary');
        
        // Render Fondo
        qParticles.forEach(p => {
            p.dist += p.v;
            let x = qCanvas.width/2 + Math.cos(p.angle) * p.dist;
            let y = qCanvas.height/2 + Math.sin(p.angle) * p.dist;
            if(x < 0 || x > qCanvas.width || y < 0 || y > qCanvas.height) p.dist = 0;
            
            qCtx.beginPath(); qCtx.arc(x, y, p.s, 0, Math.PI*2);
            qCtx.fillStyle = color; qCtx.globalAlpha = 0.15; qCtx.fill();
        });
        
        // Render Núcleo
        dCtx.clearRect(0,0,300,300);
        dParticles.forEach(p => {
            p.a += p.v;
            let breath = Math.sin(Date.now()*0.002) * 8; // La respiración
            let x = 150 + Math.cos(p.a) * (p.r + breath);
            let y = 150 + Math.sin(p.a) * (p.r + breath);
            dCtx.beginPath(); dCtx.arc(x, y, p.s, 0, Math.PI*2);
            dCtx.fillStyle = color; dCtx.shadowBlur = 15; dCtx.shadowColor = color; dCtx.fill();
        });
        requestAnimationFrame(animateDante);
    }

    window.onload = () => { 
        initAudio(); 
        initDanteEcosystem(); 
        render(); 
    };
</script>
</body>
</html>