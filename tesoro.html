<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GOVOTTO: LOOT ROOM V2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@700&family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        :root { 
            --bg: #050505; 
            --gold: #FFD700;
            --rare: #9d00ff;
            --common: #10b981;
            --locked: #fff;
        }

        body { 
            background: var(--bg); height: 100vh; display: flex; flex-direction: column;
            font-family: 'Outfit', sans-serif; color: white; user-select: none; overflow: hidden;
            background-image: radial-gradient(circle at 50% 30%, rgba(255, 215, 0, 0.05) 0%, transparent 60%);
        }

        /* HEADER */
        .header { display: flex; justify-content: space-between; align-items: center; padding: 20px; z-index: 10; }
        .title { font-weight: 900; font-style: italic; font-size: 1.5rem; letter-spacing: -1px; text-shadow: 0 0 20px rgba(255, 215, 0, 0.3); }
        .title span { color: var(--gold); }
        .close-btn { width: 40px; height: 40px; border-radius: 50%; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; cursor: pointer; border: 1px solid rgba(255,255,255,0.2); transition: 0.2s; }
        .close-btn:active { background: white; color: black; transform: scale(0.9); }

        /* RACK DE CAJAS */
        .loot-rack { 
            flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; 
            gap: 25px; padding: 20px; perspective: 1000px;
        }

        /* ESTILO DE CAJA GENÉRICA */
        .loot-box {
            width: 100%; max-width: 340px; height: 100px;
            background: linear-gradient(145deg, #151515, #0a0a0a);
            border: 1px solid #333; border-radius: 16px;
            display: flex; align-items: center; padding: 0 20px; gap: 20px;
            position: relative; cursor: pointer; transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            overflow: hidden;
        }
        
        .loot-box::before { content: ''; position: absolute; inset: 0; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.03), transparent); transform: translateX(-100%); transition: 0.5s; }
        .loot-box:active { transform: scale(0.96) rotateX(5deg); }

        /* ICONO CAJA (AHORA TODOS RESPIRAN) */
        .box-icon-container {
            width: 60px; height: 60px; background: #000; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem; border: 1px solid #333; position: relative;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.8);
            /* ANIMACIÓN AGREGADA AQUÍ PARA TODOS */
            animation: breath 3s infinite ease-in-out;
        }

        /* TEXTOS */
        .box-info { flex: 1; }
        .box-title { font-weight: 900; font-size: 1.1rem; text-transform: uppercase; line-height: 1; margin-bottom: 6px; }
        
        /* CORRECCIÓN DE VISIBILIDAD DE TEXTO */
        .box-desc { 
            font-family: 'JetBrains Mono'; 
            font-size: 0.75rem; /* Un poco más grande */
            font-weight: 700;   /* Más grueso */
            letter-spacing: 0.5px; 
            text-transform: uppercase;
        }
        
        .status-badge { font-size: 0.6rem; font-weight: 900; padding: 4px 8px; border-radius: 4px; background: #222; color: #555; border: 1px solid #333; }

        /* --- TIPOS DE CAJAS --- */

        /* 1. CAJA DIARIA (READY) */
        .lb-daily { border-color: var(--common); box-shadow: 0 0 20px rgba(16, 185, 129, 0.1); }
        .lb-daily .box-icon-container { color: var(--common); border-color: var(--common); box-shadow: 0 0 15px rgba(16, 185, 129, 0.2); }
        .lb-daily .box-title { color: white; }
        .lb-daily .box-desc { color: var(--common); text-shadow: 0 0 5px rgba(16,185,129,0.5); } /* TEXTO VISIBLE */
        .lb-daily .status-badge { background: rgba(16, 185, 129, 0.2); color: var(--common); border-color: var(--common); }

        /* 2. CAJA SEMANAL (LOCKED) */
        .lb-weekly { border-color: #555; }
        .lb-weekly .box-icon-container { color: #fff; border-color: #555; }
        .lb-weekly .box-title { color: #ccc; }
        .lb-weekly .box-desc { color: #999; } /* TEXTO VISIBLE */
        .lb-weekly .status-badge { background: #222; color: #fff; border-color: #555; }

        /* 3. VIP (GOLD) */
        .lb-vip { border-color: var(--gold); background: linear-gradient(145deg, #1a1200, #050505); }
        .lb-vip .box-icon-container { color: var(--gold); border-color: var(--gold); box-shadow: 0 0 15px rgba(255, 215, 0, 0.2); }
        .lb-vip .box-title { color: var(--gold); text-shadow: 0 0 10px rgba(255,215,0,0.4); }
        .lb-vip .box-desc { color: #ffeebb; text-shadow: 0 0 5px rgba(255, 215, 0, 0.3); } /* TEXTO VISIBLE */
        .lb-vip .status-badge { background: rgba(255, 215, 0, 0.1); color: var(--gold); border-color: var(--gold); }

        /* ESTADO ABIERTO */
        .lb-opened { filter: grayscale(1); opacity: 0.5; pointer-events: none; border-color: #333 !important; }
        .lb-opened .box-icon-container { animation: none; }
        .lb-opened .status-badge { content: 'ABIERTO'; background: #333 !important; color: #888 !important; }

        /* ANIMACIONES */
        @keyframes breath { 
            0%, 100% { transform: scale(1); opacity: 0.9; } 
            50% { transform: scale(1.05); opacity: 1; text-shadow: 0 0 10px currentColor; } 
        }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.1); filter: brightness(2); } 100% { transform: scale(1); } }

        /* REWARD OVERLAY (POPUP DE PREMIO) */
        .reward-overlay { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 50; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: 0.3s;
        }
        .show-reward { opacity: 1; pointer-events: auto; }
        
        .reward-card { 
            text-align: center; transform: scale(0.5); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        }
        .show-reward .reward-card { transform: scale(1); }

        .reward-icon { font-size: 5rem; color: var(--common); margin-bottom: 20px; filter: drop-shadow(0 0 30px var(--common)); animation: float 3s infinite ease-in-out; }
        .reward-val { font-size: 3rem; font-weight: 900; color: white; line-height: 1; }
        .reward-sub { font-family: 'JetBrains Mono'; color: #888; font-size: 0.9rem; margin-top: 5px; }
        
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

    </style>
</head>
<body>

    <div class="header">
        <div class="title">SALA DE <span>TESOROS</span></div>
        <div class="close-btn" onclick="exitLoot()"><i class="fas fa-times"></i></div>
    </div>

    <div class="loot-rack">
        
        <div id="chest-daily" class="loot-box lb-daily" onclick="openDaily()">
            <div class="box-icon-container"><i class="fas fa-cube"></i></div>
            <div class="box-info">
                <div class="box-title">SUMINISTROS</div>
                <div class="box-desc">DISPONIBLE CADA 24H</div>
            </div>
            <div class="status-badge" id="lbl-daily">LISTO</div>
        </div>

        <div class="loot-box lb-weekly" onclick="shakeLock(this)">
            <div class="box-icon-container"><i class="fas fa-lock"></i></div>
            <div class="box-info">
                <div class="box-title">BÓVEDA TITÁN</div>
                <div class="box-desc">REQUIERE LLAVE NIVEL 5</div>
            </div>
            <div class="status-badge"><i class="fas fa-lock"></i> 168H</div>
        </div>

        <div class="loot-box lb-vip" onclick="shakeLock(this)">
            <div class="box-icon-container"><i class="fas fa-briefcase"></i></div>
            <div class="box-info">
                <div class="box-title">MALETÍN BLACK</div>
                <div class="box-desc">EXCLUSIVO MIEMBROS</div>
            </div>
            <div class="status-badge">EVENTO</div>
        </div>

    </div>

    <div id="reward-screen" class="reward-overlay" onclick="closeReward()">
        <div class="reward-card">
            <div class="reward-icon"><i class="fas fa-coins"></i></div>
            <div class="reward-val">+$500</div>
            <div class="reward-sub">BONIFICACIÓN DIARIA</div>
            <div style="margin-top: 30px; font-size: 0.7rem; color: #444;">TOCA PARA RECLAMAR</div>
        </div>
    </div>

    <script>
        // --- 1. MOTOR DE AUDIO (SIN ARCHIVOS MP3) ---
        const AudioEngine = {
            ctx: null,
            init: function() { if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)(); },
            playTone: function(freq, type, dur) {
                if(!this.ctx) return;
                const o = this.ctx.createOscillator(); const g = this.ctx.createGain();
                o.type = type; o.frequency.value = freq;
                o.connect(g); g.connect(this.ctx.destination);
                o.start(); g.gain.exponentialRampToValueAtTime(0.00001, this.ctx.currentTime + dur);
                o.stop(this.ctx.currentTime + dur);
            },
            unlock: function() { this.playTone(600, 'sine', 0.1); setTimeout(()=>this.playTone(1200,'square',0.2), 100); },
            deny: function() { this.playTone(150, 'sawtooth', 0.3); },
            open: function() { this.playTone(200, 'triangle', 0.5); setTimeout(()=>this.playTone(800,'sine',0.8), 200); }
        };

        // --- 2. LÓGICA DE ESTADO ---
        // Verificar si ya se abrió hoy
        const lastClaim = localStorage.getItem('govotto_daily_date');
        const today = new Date().toDateString();
        const dailyBox = document.getElementById('chest-daily');
        const dailyLbl = document.getElementById('lbl-daily');
        let money = 0;

        // Si ya se reclamó hoy, bloquear visualmente al inicio
        if (lastClaim === today) {
            dailyBox.classList.remove('lb-daily');
            dailyBox.classList.add('lb-opened');
            dailyLbl.innerText = "ABIERTO";
            dailyBox.onclick = null; // Desactivar click
        }

        // --- 3. FUNCIONES DE INTERACCIÓN ---

        function openDaily() {
            AudioEngine.init();
            
            // Animación de apertura
            dailyBox.style.animation = 'pop 0.3s forwards';
            AudioEngine.open();
            
            // Confeti
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#10b981', '#ffffff'] });

            setTimeout(() => {
                // Mostrar Premio
                const screen = document.getElementById('reward-screen');
                screen.classList.add('show-reward');
                
                // Guardar estado
                localStorage.setItem('govotto_daily_date', today);
                
                // Cambiar visualmente la caja
                dailyBox.classList.remove('lb-daily');
                dailyBox.classList.add('lb-opened');
                dailyLbl.innerText = "ABIERTO";
                dailyBox.onclick = null;

                // Definir premio para enviar
                money = 500; 

            }, 500);
        }

        function shakeLock(el) {
            AudioEngine.init();
            AudioEngine.deny();
            // Vibración
            if(navigator.vibrate) navigator.vibrate([50, 50, 50]);
            
            // Animación CSS
            el.style.animation = 'none';
            el.offsetHeight; /* trigger reflow */
            el.style.animation = 'shake 0.4s';
        }

        function closeReward() {
            // 1. Quitamos el aviso de premio de la pantalla
            document.getElementById('reward-screen').classList.remove('show-reward');

            // 2. BLINDAJE RYZEN: Guardamos el dinero físicamente en el PC
            let currentVault = parseInt(localStorage.getItem('govotto_vault')) || 0;
            let newTotal = currentVault + money;
            localStorage.setItem('govotto_vault', newTotal);

            // 3. OÍDO CENTRAL: Avisamos al mapa que sume el premio al HUD
            try {
                window.parent.postMessage({ 
                    action: 'close_loot', 
                    reward: money 
                }, '*');
            } catch(e) {
                console.log("Error de comunicación con la base");
            }
            
            // 4. Salida automática después de 300ms
            setTimeout(() => exitLoot(), 300);
        }

        function exitLoot() {
            try {
                // Enviamos mensaje de cierre (incluso si no ganó nada)
                window.parent.postMessage({ action: 'close_loot_window' }, '*');
            } catch(e) {
                console.log("Modo standalone");
            }
        }

    </script>
</body>
</html>